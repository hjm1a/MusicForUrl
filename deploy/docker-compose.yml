services:
  music-for-url:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
      args:
        # 可选：基础镜像（用于无法访问 Docker Hub 时切换到可用镜像源）
        NODE_IMAGE: ${NODE_IMAGE:-node:20-alpine}
        # 可选：Alpine 仓库镜像（不带协议），例如 mirrors.aliyun.com/alpine
        ALPINE_REPO_MIRROR: ${ALPINE_REPO_MIRROR:-}
        # 可选：npm 镜像，例如 https://registry.npmmirror.com
        NPM_REGISTRY: ${NPM_REGISTRY:-}
    container_name: music-for-url
    ports:
      - "3000:3000"
    volumes:
      # 数据持久化（SQLite + HLS 分片缓存）
      - music-for-url-data:/app/data
      # 如需绑定到宿主机目录（Linux 常用），改为：
      # - ../data:/app/data
    environment:
      NODE_ENV: production
      PORT: 3000
      # 生产环境必填：Cookie 加密密钥（至少16位，建议32位字符串；纯数字务必加引号）
      ENCRYPTION_KEY: "your-32-character-secret-key-here"
      CACHE_TTL: 86400
    restart: unless-stopped

volumes:
  music-for-url-data:
